# ИИ-агент с инструментами и MCP-серверами

ИИ-агент на Python с поддержкой множества инструментов для работы с кодом, файлами, документацией и выполнения задач через OpenAI-совместимые API и MCP-серверы.

## Возможности

- **Работа с кодом**: семантический поиск, grep, поиск файлов
- **Работа с файлами**: чтение, запись, редактирование, удаление
- **Инструменты разработки**: линтеры, выполнение команд, управление задачами
- **Внешние источники**: поиск в интернете
- **MCP-серверы**: интеграция с Context7, Time и другими MCP серверами
- **CLI интерфейс**: интерактивный чат и одноразовые запросы

## Установка

1. Клонируйте репозиторий или скопируйте файлы проекта

2. Установите зависимости:

```bash
pip install -r requirements.txt
```

3. Настройте API ключ через файл `.env` в корне проекта:

```bash
# Создайте файл .env
echo "OPENAI_API_KEY=your-api-key-here" > .env
```

Также можно использовать переменные окружения системы:
```bash
export OPENAI_API_KEY="your-api-key-here"
```

## Конфигурация

Скопируйте и отредактируйте `config/default.yaml`:

```yaml
llm:
  model: "gpt-4o-mini"
  provider: "openai"
  temperature: 0.7

mcpServers:
  # Настройка MCP серверов (опционально)
```

## Использование

### Интерактивный чат

```bash
python -m src.cli.main chat
```

Или после установки пакета:

```bash
ai-agent chat
```

### Одноразовый запрос

```bash
python -m src.cli.main execute "Найди все функции работы с базой данных"
```

### Индексация проекта

Для использования семантического поиска по коду сначала проиндексируйте проект:

```bash
python -m src.cli.main index /path/to/project
```

## Доступные инструменты

### Поиск и навигация

- **codebase_search** - семантический поиск по кодовой базе
- **grep** - поиск по регулярным выражениям
- **glob_file_search** - поиск файлов по шаблонам

### Работа с файлами

- **read_file** - чтение файлов
- **write** - создание/перезапись файлов
- **search_replace** - редактирование через поиск и замену
- **delete_file** - удаление файлов
- **list_dir** - просмотр содержимого директорий

### Разработка

- **read_lints** - проверка кода линтерами (flake8, pylint, mypy, ruff)
- **run_terminal_cmd** - выполнение команд в терминале
- **todo_write** - управление списком задач

### Внешние источники

- **web_search** - поиск в интернете (DuckDuckGo или Tavily)

### MCP-серверы

- **Context7** - документация библиотек
- **Time** - работа со временем
- Другие MCP серверы через конфигурацию

## Примеры использования

### Поиск кода

```
Вы: Найди все функции, которые работают с аутентификацией
```

Агент использует `codebase_search` для семантического поиска.

### Редактирование файла

```
Вы: Добавь валидацию email в функцию register_user в файле auth.py
```

Агент найдет функцию, прочитает файл, внесет изменения.

### Работа с линтером

```
Вы: Проверь код в директории src на ошибки
```

Агент использует `read_lints` для проверки кода.

### Выполнение команд

```
Вы: Запусти тесты для проекта
```

Агент использует `run_terminal_cmd` для выполнения команды.

## MCP серверы

Для использования MCP серверов настройте их в `config/default.yaml`:

```yaml
mcpServers:
  context7:
    command: ["node"]  # или строка: "/path/to/command"
    args: ["path/to/context7-server.js"]
    transport: "stdio"  # stdio или http
    env: {}
  time:
    command: "uvx"
    args:
      - "mcp-server-time"
      - "--local-timezone=Europe/Moscow"
    transport: "stdio"
    env: {}
```

**Транспорт**: Поддерживается `stdio` и `http`.

**Загрузка инструментов**: При запуске агент автоматически подключается к каждому MCP серверу из конфигурации, выполняет инициализацию протокола и загружает список доступных инструментов. Все инструменты из MCP серверов автоматически добавляются к набору доступных инструментов агента и могут использоваться LLM для выполнения задач. Инструменты из MCP серверов имеют префикс `имя_сервера.имя_инструмента` (например, `time.get_current_time`).

## Структура проекта

```
ai-agent/
├── src/
│   ├── agent/          # Оркестратор и управление диалогом
│   ├── llm/            # Клиент для языковых моделей
│   ├── tools/          # Инструменты агента
│   │   ├── code/       # Инструменты для работы с кодом
│   │   ├── file/       # Инструменты для работы с файлами
│   │   ├── dev/        # Инструменты разработки
│   │   └── external/   # Внешние инструменты
│   ├── mcp/            # MCP протокол и клиент
│   └── cli/            # CLI интерфейс
├── config/             # Конфигурация
└── requirements.txt    # Зависимости
```

## Требования

- Python 3.10+
- OpenAI API ключ или другой провайдер через litellm
- (Опционально) MCP серверы для расширенной функциональности

## Лицензия

MIT

